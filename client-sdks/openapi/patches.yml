# Patches applied to the OpenAPI spec after merging with Stainless config.
#
# These fix schema issues that cause problems with openapi-generator code generation.
# Each patch targets a specific dotted path in the spec and applies an action.

operations:
  # Add discriminator mapping to OpenAIResponseInput
  - path: "components.schemas.OpenAIResponseInput.discriminator"
    action: "set"
    value:
      propertyName: type
      mapping:
        message: '#/components/schemas/OpenAIResponseMessage'
        function_call_output: '#/components/schemas/OpenAIResponseInputFunctionToolCallOutput'
        mcp_approval_response: '#/components/schemas/OpenAIResponseMCPApprovalResponse'
        file_search_call: '#/components/schemas/OpenAIResponseOutput'
        function_call: '#/components/schemas/OpenAIResponseOutput'
        mcp_approval_request: '#/components/schemas/OpenAIResponseOutput'
        mcp_call: '#/components/schemas/OpenAIResponseOutput'
        mcp_list_tools: '#/components/schemas/OpenAIResponseOutput'
        web_search_call: '#/components/schemas/OpenAIResponseOutput'

  # Remove finish_reason from required in OpenAIChoice
  - path: "components.schemas.OpenAIChoice.required"
    action: "remove_item"
    value: "finish_reason"

  # Make finish_reason nullable in OpenAIChoice
  - path: "components.schemas.OpenAIChoice.properties.finish_reason.nullable"
    action: "set"
    value: true

  # Remove finish_reason from required in OpenAIChunkChoice
  - path: "components.schemas.OpenAIChunkChoice.required"
    action: "remove_item"
    value: "finish_reason"

  # Make finish_reason nullable in OpenAIChunkChoice
  - path: "components.schemas.OpenAIChunkChoice.properties.finish_reason.nullable"
    action: "set"
    value: true

  # Remove finish_reason from required in OpenAICompletionChoice
  - path: "components.schemas.OpenAICompletionChoice.required"
    action: "remove_item"
    value: "finish_reason"

  # Remove text from required in OpenAICompletionChoice
  - path: "components.schemas.OpenAICompletionChoice.required"
    action: "remove_item"
    value: "text"

  # Make finish_reason nullable in OpenAICompletionChoice
  - path: "components.schemas.OpenAICompletionChoice.properties.finish_reason.nullable"
    action: "set"
    value: true

  # Make text nullable in OpenAICompletionChoice
  - path: "components.schemas.OpenAICompletionChoice.properties.text.nullable"
    action: "set"
    value: true

  # Simplify ToolConfig.tool_choice to avoid confusing oneOf with overlapping string types
  - path: "components.schemas.ToolConfig.properties.tool_choice"
    action: "set"
    value:
      type: string
      description: "(Optional) Whether tool use is automatic, required, or none. Can also specify a tool name to use a specific tool. Defaults to auto."
      default: "auto"

  # Make aggregated_results optional in ScoringResult (server may not always return it)
  - path: "components.schemas.ScoringResult.required"
    action: "remove_item"
    value: "aggregated_results"

  # Make aggregated_results nullable in ScoringResult
  - path: "components.schemas.ScoringResult.properties.aggregated_results.nullable"
    action: "set"
    value: true

  # Simplify input_rows in ScoreRequest to avoid additionalProperties oneOf issues
  - path: "components.schemas.ScoreRequest.properties.input_rows"
    action: "set"
    value:
      type: array
      items:
        type: object
        additionalProperties: true
      description: "The rows to score."

  # Make Error model fields optional and flexible for better error handling.
  # Servers may omit status/title or return structured objects in detail.
  - path: "components.schemas.Error.required"
    action: "remove_item"
    value: "status"

  - path: "components.schemas.Error.required"
    action: "remove_item"
    value: "title"

  - path: "components.schemas.Error.properties.detail"
    action: "set"
    value:
      description: "Error detail - can be a string or structured error object"
      oneOf:
        - type: string
        - type: object

  # Mark response models that support output_text extraction
  - path: "components.schemas.OpenAIResponseObject.x-has-output-text"
    action: "set"
    value: true

  - path: "components.schemas.OpenAIResponseObjectWithInput.x-has-output-text"
    action: "set"
    value: true
